PART="partI"
PARTICIPANT_NUMBER="$1"

source config

TIMEOUT="3"
INTENSITY="0"
PARAMETER="255"
CONTINUE_TIMEOUT="30"

function intensityStep {
  let "INTENSITY+=10"
}

function intensityKeypress {
  enough="no"
  readChar="1"
  while [ "$readChar" -ne "0" ] && [ "$INTENSITY" -lt "$ACTUATOR_MAX" ]; do
    intensityStep

    echo "sm $ACTUATOR $ACTUATOR_MODE six/0.1" > $PORT
    echo "sp $ACTUATOR $PARAMETER six/0.1" > $PORT

    echo "si $ACTUATOR $INTENSITY six/0.1" > $PORT
    #read -n1 -t $TIMEOUT -p "$INTENSITY >> " enough
    read -n1 -t $TIMEOUT enough
    readChar=$?

    echo "sm $ACTUATOR OFF six/0.1" > $PORT

    if [ "$readChar" -eq "0" ]; then
      break
    fi

    sleep $TIMEOUT
  done
}

function logStatistic {
  echo "$1 $INTENSITY" >> $STATISTIC_LOG
}

function runStatistic {
  echo -e "$ACTYATOR_TYPE" >> $STATISTIC_LOG
  echo "-------------------------------------" >> $STATISTIC_LOG

  read -n1 -t $CONTINUE_TIMEOUT -p "Druecken Sie eine beliege Taste um zu beginnen" start
  echo -e "\nDruecken Sie eine Taste sobald Sie anfangen den Aktuator zu spueren."

  intensityKeypress
  logStatistic "min:"

  echo "Okay, vielen Dank!"
  read -n1 -t $CONTINUE_TIMEOUT -p "Druecken Sie eine beliebige Taste um fortzufahren" cont
  echo -e "\nDruecken Sie eine beliebige Taste, sobald der Aktuator Ihnen unangenehm wird"

  intensityKeypress
  logStatistic "max:"

  echo -e "\n\n" >> $STATISTIC_LOG

  echo "sm $ACTUATOR OFF six/0.1" > $PORT
}
