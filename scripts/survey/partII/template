PART="partII"
PARTICIPANT_NUMBER="$1"
SEQUENCE_NUMBER="0"

source config

PARAMETER="255"

INTENSITY1="0"
INTERVAL1="0"
INTENSITY2="0"
INTERVAL2="0"

SHOW_VALUES="yes"

function loadIntensity {
  declare -a 'values=('"$1"')'
  #eval values=($1)
  INTENSITY1=${values[0]}
  INTERVAL1=${values[1]}
  INTENSITY2=${values[2]}
  INTERVAL2=${values[3]}
}

function applyValues {
  echo "sm $ACTUATOR $ACTUATOR_MODE six/0.1" > $PORT
  echo "sp $ACTUATOR $PARAMETER six/0.1" > $PORT

  if [ "$1" == "showValues" ]; then
    echo "Intensitaet: $INTENSITY1" > $TTY
  fi

  echo "si $ACTUATOR $INTENSITY1 six/0.1" > $PORT
  sleep "$INTERVAL1"


  if [ "$1" == "showValues" ]; then
    echo "Intensitaet: $INTENSITY2" > $TTY
  fi

  echo "si $ACTUATOR $INTENSITY2 six/0.1" > $PORT
  sleep "$INTERVAL2"

  echo "sm $ACTUATOR OFF six/0.1" > $PORT
}

function printResolution {
  RESOLUTION=$(echo $1 | sed -e 's/.*_\([0-9]*\).txt/\1/g')
  if [ -n $RESOLUTION ]; then
    echo "Sie werden nun eine Aufloesung von $RESOLUTION spueren"
  fi
}

function runBatchFile {
  while read line; do
    loadIntensity "$line"

    applyValues $1

    if [ "$1" == "test" ]; then
      echo "Bitte geben Sie das Intensitaets-Level ein, das Sie gefuehlt haben."
      read -p "Erster Wert: " firstValue  < $TTY
      read -p "Zweiter Wert: " secondValue < $TTY

      let SEQUENCE_NUMBER+=1
      echo "$#SEQUENCE_NUMBER correct:" $INTENSITY1 "to" $INTENSITY2 >> $STATISTIC_LOG
      echo -e "#SEQUENCE_NUMBER guessed:" $firstValue "to" $secondValue "\n" >> $STATISTIC_LOG
    fi

    read -n1 -p "Druecken Sie eine beliebige Taste, um fortzufahren" start < $TTY
  done <$2
}

function runStatistic {
  echo -e "$ACTYATOR_TYPE" >> $STATISTIC_LOG
  echo "-------------------------------------" >> $STATISTIC_LOG

  echo -e "\nKalibrierungs-Phase: Sie werden zwei verschiedene Level"
  echo -e "    an Stimulation auf dem Aktuator fuehlen. Die Werte werden"
  echo -e "    Ihnen dabei jeweils angezeigt.\n"
  read -n1 -p "Druecken Sie einen beliebige Taste, um zu beginnen" start

  for CALIBRATE_FILE in execution/$ACTYATOR_TYPE/calibrate*.txt; do
    printResolution $CALIBRATE_FILE
    echo "Ask the supervisors what $CALIBRATE_FILE means ;)"
    runBatchFile "showValues" $CALIBRATE_FILE
  done

  echo -e "\nTest-Phase: Bitte versuchen Sie, den Start und End-Wert"
  echo "        der Stimulation zu fuehlen. Geben Sie dann die Werte"
  echo -e "        ein, die Sie denken gefuehlt zu haben.\n"
  read -n1 -p "Druecken Sie eine beliebige Taste, um zu beginnen" start

  for TEST_FILE in execution/$ACTYATOR_TYPE/test*.txt; do
    printResolution $TEST_FILE
    runBatchFile "test" $TEST_FILE
  done
}
