PART="partII"
PARTICIPANT_NUMBER="$1"

source config

PARAMETER="255"

INTENSITY1="0"
INTERVAL1="0"
INTENSITY2="0"
INTERVAL2="0"

SHOW_VALUES="yes"

function loadIntensity {
  declare -a 'values=('"$1"')'
  #eval values=($1)
  INTENSITY1=${values[0]}
  INTERVAL1=${values[1]}
  INTENSITY2=${values[2]}
  INTERVAL2=${values[3]}
}

function applyValues {
  echo "sm $ACTUATOR $ACTUATOR_MODE six/0.1" > $PORT
  echo "sp $ACTUATOR $PARAMETER six/0.1" > $PORT

  if [ "$1" == "showValues" ]; then
    echo "Intensity: $INTENSITY1" > $TTY
  fi

  echo "si $ACTUATOR $INTENSITY1 six/0.1" > $PORT
  sleep "$INTERVAL1"


  if [ "$1" == "showValues" ]; then
    echo "Intensity: $INTENSITY2" > $TTY
  fi

  echo "si $ACTUATOR $INTENSITY2 six/0.1" > $PORT
  sleep "$INTERVAL2"

  echo "sm $ACTUATOR OFF six/0.1" > $PORT
}

function runBatchFile {
  while read line; do
    loadIntensity "$line"

    applyValues $1

    if [ "$1" == "test" ]; then
      echo "please enter the intensity levels you felt"
      read -p "first value: " firstValue  < $TTY
      read -p "second value: " secondValue < $TTY

      echo "correct:" $INTENSITY1 "to" $INTENSITY2 >> $STATISTIC_LOG
      echo -e "guessed:" $firstValue "to" $secondValue "\n" >> $STATISTIC_LOG
    fi

    read -n1 -p "press a key to continue" start < $TTY
  done <$2
}

function runStatistic {
  echo -e "$ACTYATOR_TYPE" >> $STATISTIC_LOG
  echo "-------------------------------------" >> $STATISTIC_LOG

  echo -e "\ncalibration phase: you will feel two stimulation  levels"
  echo -e "    of the actuator. The values will appear accordingly.\n"
  read -n1 -p "press any key to start" start

  for CALIBRATE_FLE in execution/$ACTYATOR_TYPE/calibrate*.txt; do
    echo "Ask the supervisors what $CALIBRATE_FLE means ;)"
    runBatchFile "showValues" $CALIBRATE_FLE
  done

  echo -e "\ntest phase: please first try to  feel the start  and end"
  echo "        level of stimmulation, then enter the values you"
  echo -e "        think you have felt.\n"
  read -n1 -p "press any key to start" start

  for TEST_FLIE in execution/$ACTYATOR_TYPE/test*.txt; do
    runBatchFile "test" $TEST_FLIE
  done
}
